<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora: À Vista ou Parcelado?</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;}
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; margin-top: 20px; cursor: pointer; font-size: 16px;}
        button:hover { background-color: #0056b3; }
        #resultado { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .win { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .loss { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

<div class="card">
    <h2>Calculadora de Decisão de Compra</h2>
    <p>Vale a pena pegar o desconto ou parcelar e investir?</p>

    <label>Preço à Vista (com desconto):</label>
    <input type="number" id="precoVista" value="3149.91" step="0.01">

    <label>Valor da Parcela:</label>
    <input type="number" id="valorParcela" value="291.75" step="0.01">

    <label>Número de Parcelas:</label>
    <input type="number" id="numParcelas" value="12">

    <label>Taxa Selic Anual (%):</label>
    <input type="number" id="taxaSelic" value="15.0" step="0.1">
    <small style="color: #666;">*O cálculo descontará automaticamente IR estimado.</small>

    <button onclick="calcular()">Calcular Melhor Opção</button>

    <div id="resultado"></div>
    <div id="tabelaContainer"></div>
</div>

<script>
    function calcular() {
        // Entradas
        const pv = parseFloat(document.getElementById('precoVista').value);
        const pmt = parseFloat(document.getElementById('valorParcela').value);
        const n = parseInt(document.getElementById('numParcelas').value);
        const selic = parseFloat(document.getElementById('taxaSelic').value);

        // Cálculo da taxa mensal líquida estimada
        // Selic anual -> mensal composta
        const taxaMensalBruta = Math.pow((1 + selic/100), 1/12) - 1;
        
        // Descontando IR médio de 20% sobre o lucro para simplificar (regressiva de curto prazo)
        const taxaMensalLiquida = taxaMensalBruta * 0.80; 

        let saldo = pv;
        let htmlTabela = '<table><tr><th>Mês</th><th>Rendimento</th><th>Pagamento</th><th>Saldo Final</th></tr>';
        
        // Simulação mês a mês
        for (let i = 1; i <= n; i++) {
            let rendimento = saldo * taxaMensalLiquida;
            let saldoPosRendimento = saldo + rendimento;
            let novoSaldo = saldoPosRendimento - pmt;
            
            htmlTabela += `<tr>
                <td>${i}</td>
                <td>R$ ${rendimento.toFixed(2)}</td>
                <td>R$ ${pmt.toFixed(2)}</td>
                <td style="color: ${novoSaldo < 0 ? 'red' : 'black'}">R$ ${novoSaldo.toFixed(2)}</td>
            </tr>`;
            
            saldo = novoSaldo;
        }
        htmlTabela += '</table>';

        const resultadoDiv = document.getElementById('resultado');
        const tabelaDiv = document.getElementById('tabelaContainer');

        if (saldo >= 0) {
            resultadoDiv.className = 'win';
            resultadoDiv.innerHTML = `<strong>PARCELE!</strong><br>Ao final, ainda sobrariam R$ ${saldo.toFixed(2)} no seu bolso. O rendimento superou o desconto.`;
        } else {
            resultadoDiv.className = 'loss';
            resultadoDiv.innerHTML = `<strong>PAGUE À VISTA!</strong><br>Se parcelar, faltarão <strong>R$ ${Math.abs(saldo).toFixed(2)}</strong> para pagar a última parcela. O desconto de 10% é superior ao rendimento da Selic.`;
        }
        
        resultadoDiv.style.display = 'block';
        tabelaDiv.innerHTML = htmlTabela;
    }
</script>

</body>
</html>